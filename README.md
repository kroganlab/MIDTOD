## MIDTOD
R code for MIDTOD

## Dependencies and requirements
- R (>3.6.0) 
- Input MS files must be generated by [*MarkerView*](https://sciex.com/products/software/markerview-software) and R package [artMS](https://doi.org/doi:10.18129/B9.bioc.artMS)
- Text file of a table of significantly regulated genes

## Usage
The MIDTOD software will identify metabolites.

### Test on Example Data
To test and run on example data, download the full repository as a zip archive from Code menu above or ([click here](https://github.com/kroganlab/MIDTOD/archive/refs/heads/master.zip))

Unzip the archive. Open a command line terminal and set the new MIDTOD directory as you working directory.
The first line below sets the working directory (and is appropriate for most Mac OSX), you
will have to edit the path to the unzipped MIDTOD directory on your computer. The next set of lines
is a single command that runs MIDTOD on data files in the `example/` subdirectory.  On completion
you should see numerous output files in `example/output/`

```bash
cd ~/Downloads/MIDTOD-master/

Rscript metabolomics_pipeline.R \
             -f example/shortened.H5N1_Mouse_Lung_results-wide.txt \
             -e example/shortened.H5N1_Mouse_Lung_evidence.txt \
             -s mouse \
             -o example/output/ \
             -x example/shortened.otherOmicsData.txt

```


## More help

### Minimum command:
```bash
Rscript metabolomics_pipeline.R -f (results_file) -e (evidence_file) -x (orthogonal data file)
```
### arguments
```bash
arguments:
f=results [f]ile
e=[e]vidence file
o=[o]utput directory
s=[s]pecies
  accepted values: human, mouse
x=orthogonal data file
m=[m]ode: positive or negative.  The expected charge on the metabolites in MS
```

### More help at the command line

```bash
Rscript metabolomics_pipeline.R --help
```


##  Power users
For full control, run within R:

```R
source ("midtod.R", chdir=TRUE)

outDir <- "example/output/"
dir.create (outDir, recursive = TRUE, showWarnings = FALSE)

midtod(resultsFile  = "example/shortened.H5N1_Mouse_Lung_results-wide.txt",
       evidenceFile = "example/shortened.H5N1_Mouse_Lung_evidence.txt",
       outputDir    = outDir,
       species      = "mouse",
       remove.infinites = FALSE,
       orthogonalDataFile = "example/shortened.otherOmicsData.txt",
       log2FC = 1,
       pvalue = 0.05,
       filterResult = FALSE,
       mode = "positive"
       )

```


## Orthogonal omics data format

MIDTOD relies on detected regulation at genes in known pathways via other omics to identify regulated metabolites in metabolomics data.
This other omics data is supplied to MIDTOD via a table in tab separated format with the following column names. See file `example/shortened.otherOmicsData.txt` for a full example.

```
  experiment_id
  omics_type
  condition_2
  cell_line
  strain
  entrez_id
  symbol
  q_value
  log2fc
```
